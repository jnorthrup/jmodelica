<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>JModelica: The JMI Model interface</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.7 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>The JMI Model interface</h1>Documentation of the public JMI Model interface.  
<a href="#_details">More...</a>
<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Modules</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Defines.html">Defined constants</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Constants defined in the JMI Model interface. <br></td></tr>

<p>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__jmi__struct.html">Creation, initialization and destruction of jmi_t structs</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The main data structure in the JMI Model interface is <a class="el" href="structjmi__t.html" title="The main struct of the JMI Model interface containing dimension information and pointers...">jmi_t</a>, which contains all information needed to evaluate the functions in the JMI Model interface. <br></td></tr>

<p>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Access.html">Setters and getters for the fields in jmi_t</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The fields of <a class="el" href="structjmi__t.html" title="The main struct of the JMI Model interface containing dimension information and pointers...">jmi_t</a> are conveniently accessed using the setter and getter functions provided in the JMI Model interface. <br></td></tr>

<p>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__DAE.html">DAE interface</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Access to the DAE residual function. <br></td></tr>

<p>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Initialization.html">DAE Initialization Interface</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Access to the DAE initialization functions. <br></td></tr>

<p>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Optimization.html">Optimization interface</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Access to the optimization functions. <br></td></tr>

<p>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Misc.html">Miscanellous</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Miscanellous functions. <br></td></tr>

<p>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Documentation of the public JMI Model interface. 
<p>
<h2><a class="anchor" name="DesignConsiderations">
Design considerations</a></h2>
The JMI Model interface is intended to be used in a wide range of applications and on multiple platforms. This also includes embedded platforms in HILS applications.<p>
It is desirable that the JMI Model interface can be easily interfaced with Python. Python is the intended language for scripting in JModelica and it is therefore important that the generated code is straight forward to use with the Python extensions or ctypes framework.<p>
The JMI Model interface is intended to be used by wide range of users, with different backgrounds and programming skills. It is therefore desirable that the interface is as simple and intuitive as possible.<p>
Given these motivations, it is reasonable to use pure C where possible, and to a limited extent C++ where needed (e.g. in solver interfaces and in most likely in the AD framework).<p>
It should also be possible to build shared libraries, in order to. build applications that contains several models.<h2><a class="anchor" name="MathDescr">
Mathematical description of the JMI Model interface</a></h2>
The jmi interface consists of three parts: DAE, DAE initialization and optimization. Essentially, the jmi interface consists of a collection of functions that are offered to the user for evaluation of the DAE residual, cost functions, constraints etc. These functions takes as arguments one more of the following three argument types:<p>
Parameters (denoted <img class="formulaInl" alt="$p$" src="form_0.png">):<ul>
<li><img class="formulaInl" alt="$c_i$" src="form_1.png"> independent constant</li><li><img class="formulaInl" alt="$c_d$" src="form_2.png"> dependent constants</li><li><img class="formulaInl" alt="$p_i$" src="form_3.png"> independent parameters</li><li><img class="formulaInl" alt="$p_d$" src="form_4.png"> dependent parameters</li></ul>
<p>
with<p>
<img class="formulaInl" alt="$ p = [c_i^T, c_d^T, p_i^T, p_d^T]^T $" src="form_5.png"><p>
Variables (denoted <img class="formulaInl" alt="$v$" src="form_6.png">):<p>
<ul>
<li><img class="formulaInl" alt="$dx$" src="form_7.png"> differentiated variables</li><li><img class="formulaInl" alt="$x$" src="form_8.png"> variables that appear differentiated</li><li><img class="formulaInl" alt="$u$" src="form_9.png"> inputs</li><li><img class="formulaInl" alt="$w$" src="form_10.png"> algebraic variables</li><li><img class="formulaInl" alt="$t$" src="form_11.png"> time</li></ul>
<p>
with<p>
<img class="formulaInl" alt="$v = [dx^T, x^T, u^T, w^T, t]^T$" src="form_12.png"><p>
Variables defined at particular time instants (denoted <img class="formulaInl" alt="$q$" src="form_13.png">):<p>
<ul>
<li><img class="formulaInl" alt="$dx(t_i)$" src="form_14.png"> differentiated variables evaluated at time <img class="formulaInl" alt="$t_i, i \in 1..n_{tp}$" src="form_15.png"></li><li><img class="formulaInl" alt="$x(t_i)$" src="form_16.png"> variables that appear differentiated evaluated at time <img class="formulaInl" alt="$t_i, t_i \in 1..n_{tp}$" src="form_17.png"></li><li><img class="formulaInl" alt="$u(t_i)$" src="form_18.png"> inputs evaluated at time <img class="formulaInl" alt="$t_i, i \in 1..n_{tp}$" src="form_15.png"></li><li><img class="formulaInl" alt="$w(t_i)$" src="form_19.png"> algebraic variables evaluated at time <img class="formulaInl" alt="$t_i, i \in 1..n_{tp}$" src="form_15.png"></li></ul>
<p>
<img class="formulaInl" alt="$ q = [dx(t_1)^T, x(t_1)^T, u(t_1)^T, w(t_1)^T, ..., dx(t_{n_{tp}})^T, x(t_{n_{tp}})^T, u(t_{n_{tp}})^T, w(t_{n_{tp}})^T]^T$" src="form_20.png"><p>
All parameters, variables and point-wise evaluated variables are denoted z:<p>
<img class="formulaInl" alt="$ z = [p^T, v^T, q^T]^T $" src="form_21.png"><h3><a class="anchor" name="DAE">
The DAE interface</a></h3>
The DAE interface is defined by the residual function <img class="formulaInl" alt="$F(p,v)$" src="form_22.png"> where<p>
<img class="formulaInl" alt="$ F(p,v) = 0 $" src="form_23.png"><p>
For details on the functions included in the DAE interface, see the <a href="group__DAE.html">DAE functions documentation. </a><h3><a class="anchor" name="Init">
The DAE initialization interface</a></h3>
The DAE initialization interface is defined by the functions <img class="formulaInl" alt="$F_0(p,v)$" src="form_24.png"> and <img class="formulaInl" alt="$F_1(p,v)$" src="form_25.png"> where<p>
<img class="formulaInl" alt="$ F_0(p,v) = 0 $" src="form_26.png"><br>
 <img class="formulaInl" alt="$ F_1(p,v) = 0 $" src="form_27.png"><p>
<img class="formulaInl" alt="$F_0$" src="form_28.png"> represents the DAE system augmented with additional initial equations and start values that are fixed. <img class="formulaInl" alt="$F_1$" src="form_29.png"> on the other hand contains equations for initialization of variables for which the value given in the start attribute is not fixed.<p>
For details on the functions included in the DAE initialization interface, see the <a href="group__Initialization.html">DAE initialization functions documentation. </a><h3><a class="anchor" name="Opt">
The optimization interface</a></h3>
The optimization part of the interface is defined by the functions <img class="formulaInl" alt="$J(p,q)$" src="form_30.png">, <img class="formulaInl" alt="$C_{eq}(p,v,q)$" src="form_31.png">, <img class="formulaInl" alt="$C_{ineq}(p,v,q)$" src="form_32.png">, <img class="formulaInl" alt="$H_{eq}(p,q)$" src="form_33.png">, <img class="formulaInl" alt="$H_{ineq}(p,q)$" src="form_34.png">. Based on these functions, an optimization problem is then formulated as<p>
<img class="formulaInl" alt="$\min_{p^{opt},u}J(p,q)$" src="form_93.png"><br>
 subject to <br>
 <img class="formulaInl" alt="$C_{eq}(p,v,q) = 0$" src="form_36.png"><br>
 <img class="formulaInl" alt="$C_{ineq}(p,v,q) \leq 0$" src="form_37.png"><br>
 <img class="formulaInl" alt="$H_{eq}(p,q) = 0$" src="form_38.png"><br>
 <img class="formulaInl" alt="$H_{ineq}(p,q) \leq 0$" src="form_39.png"><br>
<p>
where <img class="formulaInl" alt="$J$" src="form_40.png"> is the cost function to be minimized, <img class="formulaInl" alt="$C_{eq}$" src="form_41.png"> are path equality constraints, <img class="formulaInl" alt="$C_{ineq}$" src="form_42.png"> are path inequality constraints, <img class="formulaInl" alt="$H_{eq}$" src="form_43.png"> are (time) point equality constraints, and <img class="formulaInl" alt="$H_{ineq}$" src="form_44.png"> are (time) point inequality constraints. The rationale for introducing <img class="formulaInl" alt="$H_{eq}$" src="form_43.png"> and <img class="formulaInl" alt="$H_{ineq}$" src="form_44.png"> is to enable expression of e.g. terminal constraints. In addition, the DAE and the DAE initialization relations are constraints in the optimization problem. The <img class="formulaInl" alt="$n_{p^{opt}}$" src="form_94.png"> optimization parameters <img class="formulaInl" alt="$p^{opt}$" src="form_95.png"> are a subset of the <img class="formulaInl" alt="$p_i$" src="form_3.png"><p>
The optimization problem is defined on the interval <img class="formulaInl" alt="$[t_0,t_f]$" src="form_45.png">, where <img class="formulaInl" alt="$t_0$" src="form_46.png"> and <img class="formulaInl" alt="$t_f$" src="form_47.png">, respectively, can be free or fixed.<p>
For details on the functions included in the optimization interface, see the <a href="group__Optimization.html">optimization functions documentation. </a><h2><a class="anchor" name="Jacobians">
Evaluation of Jacobians</a></h2>
Evaluation of Jacobians is controlled by four arguments:<p>
<ul>
<li>eval_alg This argument is used to select the method evaluation for the Jacobian. JMI_DER_SYMBOLIC and JMI_DER_CPPAD is currently supported.</li><li>sparsity This argument is a mask that selects whether sparse or dense evaluation of the Jacobian should be used. The constants JMI_DER_SPARSE are used to specify a sparse Jacobian, whereas JMI_DER_DENSE_COL_MAJOR and JMI_DER_DENSE_ROW_MAJOR are used to specify dense column major or row major Jacobians respectively.</li><li>independent_vars This argument is used to specify which variable types are considered to be independent variables in the Jacobian evaluation. The constants JMI_DER_NN are used to indicate that the Jacobian w.r.t. a particular vector should be evaluated.</li><li>mask This array has the same size as the number of column of the dense Jacobian, and holds the value of 0 if the corresponding Jacobian column should not be computed. If the value of an entry in mask i 1, then the corresponding Jacobian column will be evaluated. The evaluated Jacobian columns are stored in the first entries of the output argument jac.</li></ul>
<p>
TODO: It may be interesting to include an additional layer that enables support for partially defined Jacobians. This would be beneficial if symbolic expressions for the Jacobian is available for some entries, but for other an AD algorithm is to be used.<h2><a class="anchor" name="ErrorHandling">
Error handling</a></h2>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Feb 9 15:37:33 2009 for JModelica by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.7 </small></address>
</body>
</html>
